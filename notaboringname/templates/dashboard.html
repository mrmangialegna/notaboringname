<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="p-4">

  <h1 class="mb-4 text-center">Dashboard</h1>

  <!-- Tabs -->
  <ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="notes-tab" data-bs-toggle="tab" data-bs-target="#notes" type="button">Notes</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="calc-tab" data-bs-toggle="tab" data-bs-target="#calculator" type="button">Calculator</button>
    </li>
  </ul>

  <div class="tab-content">
    <!-- Notes Tab -->
    <div class="tab-pane fade show active" id="notes" role="tabpanel">
      <form id="noteForm" class="d-flex mb-3">
        <input type="text" name="note" class="form-control me-2" placeholder="Write a note">
        <button type="submit" class="btn btn-primary">Add</button>
      </form>
      <ul id="notesList" class="list-group mb-3"></ul>
      <a href="/download_notes" class="btn btn-success">Download Notes</a>
    </div>

    <!-- Calculator Tab -->
    <div class="tab-pane fade" id="calculator" role="tabpanel">
      <div class="mb-3">
        <input id="calcDisplay" type="text" class="form-control text-end" placeholder="0" readonly>
      </div>
      <div class="container text-center">
        <div class="row mb-2">
          <div class="col"><button class="btn btn-secondary w-100" onclick="press('7')">7</button></div>
          <div class="col"><button class="btn btn-secondary w-100" onclick="press('8')">8</button></div>
          <div class="col"><button class="btn btn-secondary w-100" onclick="press('9')">9</button></div>
          <div class="col"><button class="btn btn-warning w-100" onclick="press('/')">÷</button></div>
        </div>
        <div class="row mb-2">
          <div class="col"><button class="btn btn-secondary w-100" onclick="press('4')">4</button></div>
          <div class="col"><button class="btn btn-secondary w-100" onclick="press('5')">5</button></div>
          <div class="col"><button class="btn btn-secondary w-100" onclick="press('6')">6</button></div>
          <div class="col"><button class="btn btn-warning w-100" onclick="press('*')">×</button></div>
        </div>
        <div class="row mb-2">
          <div class="col"><button class="btn btn-secondary w-100" onclick="press('1')">1</button></div>
          <div class="col"><button class="btn btn-secondary w-100" onclick="press('2')">2</button></div>
          <div class="col"><button class="btn btn-secondary w-100" onclick="press('3')">3</button></div>
          <div class="col"><button class="btn btn-warning w-100" onclick="press('-')">−</button></div>
        </div>
        <div class="row mb-2">
          <div class="col"><button class="btn btn-secondary w-100" onclick="press('0')">0</button></div>
          <div class="col"><button class="btn btn-secondary w-100" onclick="press('.')">.</button></div>
          <div class="col"><button class="btn btn-success w-100" onclick="calculate()">=</button></div>
          <div class="col"><button class="btn btn-warning w-100" onclick="press('+')">+</button></div>
        </div>
        <div class="row mb-2">
          <div class="col"><button class="btn btn-info w-100" onclick="press('sqrt(')">√</button></div>
          <div class="col"><button class="btn btn-info w-100" onclick="press('sin(')">sin</button></div>
          <div class="col"><button class="btn btn-info w-100" onclick="press('cos(')">cos</button></div>
          <div class="col"><button class="btn btn-info w-100" onclick="press('tan(')">tan</button></div>
        </div>
        <div class="row mb-2">
          <div class="col"><button class="btn btn-info w-100" onclick="press('log(')">log</button></div>
          <div class="col"><button class="btn btn-info w-100" onclick="press('exp(')">exp</button></div>
          <div class="col"><button class="btn btn-secondary w-100" onclick="press('(')">(</button></div>
          <div class="col"><button class="btn btn-secondary w-100" onclick="press(')')">)</button></div>
        </div>
        <div class="row mb-2">
          <div class="col"><button class="btn btn-danger w-100" onclick="clearDisplay()">C</button></div>
        </div>
      </div>

      <h5 class="mt-4">History</h5>
      <ul id="calcHistory" class="list-group"></ul>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Notes
    document.getElementById("noteForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const res = await fetch("/add_note", { method: "POST", body: formData });
      const data = await res.json();
      const notesList = document.getElementById("notesList");
      notesList.innerHTML = "";
      data.notes.forEach(n => {
        const li = document.createElement("li");
        li.className = "list-group-item";
        li.innerText = n;
        notesList.appendChild(li);
      });
      e.target.reset();
    });

    // Calculator
    let display = document.getElementById("calcDisplay");

    function press(val) {
      display.value += val;
    }

    function clearDisplay() {
      display.value = "";
    }

    async function calculate() {
      const formData = new FormData();
      formData.append("expression", display.value);
      const res = await fetch("/calculate", { method: "POST", body: formData });
      const data = await res.json();

      if (data.result !== undefined) {
        display.value = data.result;
        const calcHistory = document.getElementById("calcHistory");
        calcHistory.innerHTML = "";
        data.history.forEach(h => {
          const li = document.createElement("li");
          li.className = "list-group-item";
          li.innerText = h;
          calcHistory.appendChild(li);
        });
      } else {
        display.value = "Error";
      }
    }
  </script>

</body>
</html>
